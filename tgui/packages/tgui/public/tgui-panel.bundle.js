!function(e){function t(t){for(var o,a,c=t[0],s=t[1],u=t[2],d=0,g=[];d<c.length;d++)a=c[d],Object.prototype.hasOwnProperty.call(r,a)&&r[a]&&g.push(r[a][0]),r[a]=0;for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o]);for(l&&l(t);g.length;)g.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,c=1;c<n.length;c++){var s=n[c];0!==r[s]&&(o=!1)}o&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var o={},r={2:0},i=[];function a(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=o,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var c=window.webpackJsonp=window.webpackJsonp||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var l=s;i.push([837,0]),n()}({127:function(e,t,n){"use strict";t.__esModule=!0,t.loadSettings=t.updateSettings=void 0;var o=n(32),r=(0,o.createAction)("settings/update");t.updateSettings=r;var i=(0,o.createAction)("settings/load");t.loadSettings=i},128:function(e,t,n){"use strict";t.__esModule=!0,t.selectSettings=void 0;t.selectSettings=function(e){return e.settings}},129:function(e,t,n){"use strict";t.__esModule=!0,t.rebuildChat=t.loadChat=t.updateMessageCount=t.changeChatPage=void 0;var o=n(32),r=(0,o.createAction)("chat/changePage");t.changeChatPage=r;var i=(0,o.createAction)("chat/updateMessageCount");t.updateMessageCount=i;var a=(0,o.createAction)("chat/load");t.loadChat=a;var c=(0,o.createAction)("chat/rebuild");t.rebuildChat=c},130:function(e,t,n){"use strict";t.__esModule=!0,t.canPageAcceptType=t.selectChatPageById=t.selectCurrentChatPage=t.selectChatPages=t.selectChat=void 0;var o=n(21);t.selectChat=function(e){return e.chat};t.selectChatPages=function(e){return(0,o.toArray)(e.chat.pageById)};t.selectCurrentChatPage=function(e){return e.chat.pageById[e.chat.currentPage]};t.selectChatPageById=function(e){return function(t){return t.chat.pageById[e]}};t.canPageAcceptType=function(e,t){return t.startsWith("internal")||e.acceptedTypes[t]}},365:function(e,t,n){"use strict";t.__esModule=!0,t.SettingsPanel=t.settingsReducer=t.settingsMiddleware=t.useSettings=void 0;var o=n(845);t.useSettings=o.useSettings;var r=n(846);t.settingsMiddleware=r.settingsMiddleware;var i=n(848);t.settingsReducer=i.settingsReducer;var a=n(850);t.SettingsPanel=a.SettingsPanel},366:function(e,t,n){"use strict";t.__esModule=!0,t.DEFAULT_PAGE=t.MESSAGE_TYPES=t.COMBINE_MAX_TIME_WINDOW=t.COMBINE_MAX_MESSAGES=t.MESSAGE_PRUNE_INTERVAL=t.MESSAGE_SAVE_INTERVAL=t.MAX_PERSISTED_MESSAGES=t.MAX_VISIBLE_MESSAGES=void 0;var o=n(853);function r(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}t.MAX_VISIBLE_MESSAGES=2500;t.MAX_PERSISTED_MESSAGES=1e3;t.MESSAGE_SAVE_INTERVAL=1e4;t.MESSAGE_PRUNE_INTERVAL=6e4;t.COMBINE_MAX_MESSAGES=5;t.COMBINE_MAX_TIME_WINDOW=5e3;var a=[{type:"system",name:"System Messages",description:"Messages from your client, always enabled",selector:".boldannounce, .filter_system",important:!0},{type:"unknown",name:"Unsorted Messages",description:"Everything we could not sort, always enabled",important:!0},{type:"localchat",name:"Local",description:"In-character local messages (say, emote, etc)",selector:".filter_say, .say, .emote"},{type:"radio",name:"Radio",description:"All departments of radio messages",selector:".filter_radio, .alert, .syndradio, .centradio, .airadio, .entradio, .comradio, .secradio, .engradio, .medradio, .sciradio, .supradio, .srvradio, .expradio, .radio, .deptradio, .newscaster"},{type:"info",name:"Info",description:"Non-urgent messages from the game and items",selector:".filter_notice, .notice:not(.pm), .adminnotice, .info, .sinister, .cult"},{type:"warning",name:"Warnings",description:"Urgent messages from the game and items",selector:".filter_warning, .warning:not(.pm), .critical, .userdanger, .italics"},{type:"deadchat",name:"Deadchat",description:"All of deadchat",selector:".filter_deadsay, .deadsay"},{type:"ooc",name:"OOC",description:"The bluewall of global OOC messages",selector:".filter_ooc, .ooc"},{type:"adminpm",name:"Admin PMs",description:"Messages to/from admins (adminhelp)",selector:".filter_pm, .pm"},{type:"combat",name:"Combat Log",description:"Urist McTraitor has stabbed you with a knife!",selector:".filter_combat, .danger"},{type:"adminchat",name:"Admin Chat",description:"ASAY messages",selector:".filter_ASAY, .admin_channel",admin:!0},{type:"modchat",name:"Mod Chat",description:"MSAY messages",selector:".filter_MSAY, .mod_channel",admin:!0},{type:"eventchat",name:"Event Chat",description:"ESAY messages",selector:".filter_ESAY, .event_channel",admin:!0},{type:"adminlog",name:"Admin Log",description:"ADMIN LOG: Urist McAdmin has jumped to coordinates X, Y, Z",selector:".filter_adminlog, .log_message",admin:!0},{type:"attacklog",name:"Attack Log",description:"Urist McTraitor has shot John Doe",selector:".filter_attacklog",admin:!0},{type:"debuglog",name:"Debug Log",description:"DEBUG: SSPlanets subsystem Recover().",selector:".filter_debuglog",admin:!0}];t.MESSAGE_TYPES=a;var c={id:(0,o.createUuid)(),name:"Chat",acceptedTypes:function(){for(var e,t={},n=r(a);!(e=n()).done;){t[e.value.type]=!0}return t}(),count:0};t.DEFAULT_PAGE=c},367:function(e,t,n){"use strict";t.__esModule=!0,t.pingReply=t.pingFail=t.pingSuccess=void 0;var o=n(32),r=(0,o.createAction)("ping/success",(function(e){var t=Date.now(),n=.5*(t-e.sentAt);return{payload:{lastId:e.id,roundtrip:n},meta:{now:t}}}));t.pingSuccess=r;var i=(0,o.createAction)("ping/fail");t.pingFail=i;var a=(0,o.createAction)("ping/reply");t.pingReply=a},445:function(e,t,n){"use strict";t.__esModule=!0,t.audioReducer=t.NowPlayingWidget=t.audioMiddleware=t.useAudio=void 0;var o=n(841);t.useAudio=o.useAudio;var r=n(842);t.audioMiddleware=r.audioMiddleware;var i=n(844);t.NowPlayingWidget=i.NowPlayingWidget;var a=n(851);t.audioReducer=a.audioReducer},446:function(e,t,n){"use strict";t.__esModule=!0,t.selectAudio=void 0;t.selectAudio=function(e){return e.audio}},447:function(e,t,n){"use strict";t.__esModule=!0,t.chatReducer=t.chatMiddleware=t.ChatTabs=t.ChatPanel=void 0;var o=n(852);t.ChatPanel=o.ChatPanel;var r=n(855);t.ChatTabs=r.ChatTabs;var i=n(856);t.chatMiddleware=i.chatMiddleware;var a=n(857);t.chatReducer=a.chatReducer},448:function(e,t,n){"use strict";(function(e){t.__esModule=!0,t.chatRenderer=t.serializeMessage=t.createMessage=void 0;var o=n(409),r=n(10),i=n(36),a=n(366),c=n(854),s=n(130);function u(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var d=(0,i.createLogger)("chatRenderer"),g=function(e){return Object.assign({},e,{createdAt:Date.now()})};t.createMessage=g;t.serializeMessage=function(e){return{type:e.type,text:e.text,times:e.times,createdAt:e.createdAt}};var p=function(e,t){var n=document.createElement("span");return n.className="Chat__highlight",n.setAttribute("style","background-color:"+t),n.textContent=e,n},h=function(){var e=document.createElement("div");return e.className="ChatMessage",e},f=function(){var e=document.createElement("div");return e.className="Chat__reconnected",e},m=function(e){var t=e.node,n=e.times;if(t&&n){var o=t.querySelector(".Chat__badge"),i=o||document.createElement("div");i.textContent=n,i.className=(0,r.classes)(["Chat__badge","Chat__badge--animate"]),requestAnimationFrame((function(){i.className="Chat__badge"})),o||t.appendChild(i)}},v=function(){function t(){var e=this;this.rootNode=null,this.queue=[],this.messages=[],this.visibleMessages=[],this.page=a.DEFAULT_PAGE,this.events=new o.EventEmitter,this.scrollNode=null,this.scrollTracking=!0,this.handleScroll=function(t){var n=e.scrollNode,o=n.scrollHeight,r=n.scrollTop+n.offsetHeight,i=Math.abs(o-r)<24;i!==e.scrollTracking&&(e.scrollTracking=i,e.events.emit("scrollTrackingChanged",i),d.debug("tracking",e.scrollTracking))},this.ensureScrollTracking=function(){e.scrollTracking&&e.scrollToBottom()},setInterval((function(){return e.pruneMessages()}),a.MESSAGE_PRUNE_INTERVAL)}var n=t.prototype;return n.mount=function(t){var n=this;this.rootNode?t.appendChild(this.rootNode):this.rootNode=t,this.scrollNode=function(e){for(var t=document.body,n=e;n&&n!==t;){if(n.scrollWidth<n.offsetWidth)return n;n=n.parentNode}return window}(this.rootNode),this.scrollNode.addEventListener("scroll",this.handleScroll),e((function(){n.scrollToBottom()})),this.queue.length>0&&(this.processBatch(this.queue),this.queue=[])},n.assignStyle=function(e){void 0===e&&(e={}),Object.assign(this.rootNode.style,e)},n.setHighlight=function(e,t){if(!e||!t)return this.highlightRegex=null,void(this.highlightColor=null);var n=String(e).split(",").map((function(e){return e.trim()}));this.highlightRegex=new RegExp("("+n.join("|")+")","gi"),this.highlightColor=t},n.scrollToBottom=function(){this.scrollNode.scrollTop=this.scrollNode.scrollHeight},n.changePage=function(e){this.page=e,this.rootNode.textContent="",this.visibleMessages=[];for(var t,n,o=document.createDocumentFragment(),r=u(this.messages);!(n=r()).done;){var i=n.value;(0,s.canPageAcceptType)(e,i.type)&&(t=i.node,o.appendChild(t),this.visibleMessages.push(i))}t&&(this.rootNode.appendChild(o),t.scrollIntoView())},n.getCombinableMessage=function(e){for(var t=Date.now(),n=this.visibleMessages.length,o=n-1,r=Math.max(0,n-a.COMBINE_MAX_MESSAGES),i=o;i>=r;i--){var c=this.visibleMessages[i];if(!c.type.startsWith("internal")&&c.text===e.text&&t<c.createdAt+a.COMBINE_MAX_TIME_WINDOW)return c}return null},n.processBatch=function(t,n){var o=this;void 0===n&&(n={});var r=n,i=r.prepend,l=r.notifyListeners,d=void 0===l||l;if(this.rootNode){for(var v,b,y=document.createDocumentFragment(),_={},S=u(t);!(b=S()).done;){var C=b.value,w=g(C),N=this.getCombinableMessage(w);if(N)N.times=(N.times||1)+1,m(N);else{if(w.node?v=w.node:"internal/reconnected"===w.type?v=f():((v=h()).innerHTML=w.text,this.highlightRegex&&(0,c.highlightNode)(v,this.highlightRegex,(function(e){return p(e,o.highlightColor)}))&&(v.className+=" ChatMessage--highlighted"),w.node=v),!w.type){var M=a.MESSAGE_TYPES.find((function(e){return e.selector&&v.querySelector(e.selector)}));w.type=(null==M?void 0:M.type)||"unknown"}m(w),_[w.type]||(_[w.type]=0),_[w.type]+=1,this.messages.push(w),(0,s.canPageAcceptType)(this.page,w.type)&&(y.appendChild(v),this.visibleMessages.push(w))}}if(v){var x=this.rootNode.childNodes[0];i&&x?this.rootNode.insertBefore(y,x):this.rootNode.appendChild(y),this.scrollTracking&&e((function(){return o.scrollToBottom()}))}d&&this.events.emit("batchProcessed",_)}else for(var A,I=u(t);!(A=I()).done;){var E=A.value;i?this.queue.unshift(E):this.queue.push(E)}},n.pruneMessages=function(){if(this.rootNode){var e=this.visibleMessages,t=Math.max(0,e.length-a.MAX_VISIBLE_MESSAGES);this.visibleMessages=e.slice(t);for(var n=0;n<t;n++){var o=e[n];this.rootNode.removeChild(o.node)}d.log("pruned "+t+" messages")}},n.rebuildChat=function(){if(this.rootNode){for(var e,t=Math.max(0,this.messages.length-a.MAX_PERSISTED_MESSAGES),n=this.messages.slice(t),o=u(n);!(e=o()).done;)e.value.node=undefined;this.rootNode.textContent="",this.messages=[],this.visibleMessages=[],this.processBatch(n,{notifyListeners:!1})}},t}();window.__chatRenderer__||(window.__chatRenderer__=new v);var b=window.__chatRenderer__;t.chatRenderer=b}).call(this,n(358).setImmediate)},449:function(e,t,n){"use strict";t.__esModule=!0,t.gameReducer=t.gameMiddleware=t.useGame=void 0;var o=n(859);t.useGame=o.useGame;var r=n(860);t.gameMiddleware=r.gameMiddleware;var i=n(862);t.gameReducer=i.gameReducer},450:function(e,t,n){"use strict";t.__esModule=!0,t.selectGame=void 0;t.selectGame=function(e){return e.game}},451:function(e,t,n){"use strict";t.__esModule=!0,t.connectionRestored=t.connectionLost=t.roundRestarted=void 0;var o=n(32),r=(0,o.createAction)("roundrestart");t.roundRestarted=r;var i=(0,o.createAction)("game/connectionLost");t.connectionLost=i;var a=(0,o.createAction)("game/connectionRestored");t.connectionRestored=a},452:function(e,t,n){"use strict";t.__esModule=!0,t.pingReducer=t.PingIndicator=t.pingMiddleware=void 0;var o=n(863);t.pingMiddleware=o.pingMiddleware;var r=n(864);t.PingIndicator=r.PingIndicator;var i=n(867);t.pingReducer=i.pingReducer},453:function(e,t,n){"use strict";t.__esModule=!0,t.PING_ROUNDTRIP_WORST=t.PING_ROUNDTRIP_BEST=t.PING_QUEUE_SIZE=t.PING_MAX_FAILS=t.PING_TIMEOUT=t.PING_INTERVAL=void 0;t.PING_INTERVAL=2500;t.PING_TIMEOUT=2e3;t.PING_MAX_FAILS=3;t.PING_QUEUE_SIZE=8;t.PING_ROUNDTRIP_BEST=50;t.PING_ROUNDTRIP_WORST=200},837:function(e,t,n){e.exports=n(838)},838:function(e,t,n){"use strict";n(131),n(141),n(142),n(143),n(144),n(145),n(146),n(147),n(148),n(149),n(150),n(151),n(152),n(153),n(154),n(156),n(157),n(158),n(160),n(161),n(162),n(163),n(164),n(165),n(166),n(169),n(170),n(171),n(70),n(175),n(176),n(177),n(178),n(179),n(180),n(181),n(182),n(183),n(184),n(185),n(186),n(187),n(188),n(190),n(191),n(192),n(193),n(194),n(197),n(198),n(199),n(200),n(201),n(202),n(203),n(88),n(204),n(205),n(206),n(207),n(209),n(210),n(211),n(212),n(213),n(214),n(215),n(216),n(217),n(218),n(219),n(220),n(221),n(222),n(223),n(224),n(225),n(226),n(227),n(228),n(229),n(230),n(231),n(232),n(234),n(235),n(236),n(237),n(238),n(239),n(240),n(241),n(242),n(243),n(244),n(245),n(246),n(247),n(248),n(249),n(250),n(251),n(252),n(253),n(254),n(255),n(256),n(257),n(258),n(259),n(260),n(261),n(263),n(264),n(265),n(266),n(267),n(268),n(269),n(270),n(271),n(272),n(273),n(274),n(275),n(276),n(277),n(92),n(278),n(279),n(114),n(280),n(281),n(284),n(285),n(115),n(286),n(287),n(288),n(289),n(290),n(291),n(292),n(293),n(294),n(295),n(297),n(298),n(299),n(300),n(301),n(302),n(303),n(304),n(305),n(306),n(307),n(308),n(309),n(310),n(311),n(312),n(314),n(315),n(316),n(317),n(318),n(319),n(320),n(321),n(322),n(323),n(324),n(325),n(326),n(327),n(328),n(329),n(330),n(331),n(332),n(333),n(334),n(335),n(336),n(337),n(338),n(339),n(340),n(341),n(342),n(343),n(344),n(345),n(346),n(94),n(347),n(348),n(349),n(350);var o=n(1);n(403),n(404),n(405),n(406),n(407),n(408),n(839),n(840);var r,i,a=n(119),c=n(32),s=(n(120),n(75)),u=n(410),l=n(353),d=n(411),g=n(445),p=n(447),h=n(858),f=n(449),m=n(452),v=n(365),b=n(868);a.perf.mark("inception",null==(r=window.performance)||null==(i=r.timing)?void 0:i.navigationStart),a.perf.mark("init");var y=(0,d.configureStore)({reducer:(0,c.combineReducers)({audio:g.audioReducer,chat:p.chatReducer,game:f.gameReducer,ping:m.pingReducer,settings:v.settingsReducer}),middleware:{pre:[p.chatMiddleware,m.pingMiddleware,b.telemetryMiddleware,v.settingsMiddleware,g.audioMiddleware,f.gameMiddleware]}}),_=(0,l.createRenderer)((function(){var e=n(869).Panel;return(0,o.createComponentVNode)(2,d.StoreProvider,{store:y,children:(0,o.createComponentVNode)(2,e)})}));!function S(){if("loading"!==document.readyState){for((0,s.setupGlobalEvents)({ignoreWindowFocus:!0}),(0,h.setupPanelFocusHacks)(),(0,u.captureExternalLinks)(),y.subscribe(_),window.update=function(e){return y.dispatch(Byond.parseJson(e))};;){var e=window.__updateQueue__.shift();if(!e)break;window.update(e)}Byond.winset("output",{"is-visible":!1}),Byond.winset("browseroutput",{"is-visible":!0,"is-disabled":!1,pos:"0x0",size:"0x0"})}else document.addEventListener("DOMContentLoaded",S)}()},839:function(e,t,n){},840:function(e,t,n){},841:function(e,t,n){"use strict";t.__esModule=!0,t.useAudio=void 0;var o=n(32),r=n(446);t.useAudio=function(e){return(0,o.useSelector)(e,r.selectAudio)}},842:function(e,t,n){"use strict";t.__esModule=!0,t.audioMiddleware=void 0;var o=n(843);t.audioMiddleware=function(e){var t=!1,n=new o.AudioPlayer;return function(o){return function(r){var i=r.type,a=r.payload;if(t||(t=!0,n.onPlay((function(){e.dispatch({type:"audio/playing"})})),n.onStop((function(){e.dispatch({type:"audio/stopped"})}))),"audio/playMusic"===i){var c=a.url,s=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(a,["url"]);return n.play(c,s),o(r)}if("audio/stopMusic"===i)return n.stop(),o(r);if("settings/update"===i||"settings/load"===i){var u=a.adminMusicVolume;return"number"==typeof u&&n.setVolume(u),o(r)}return o(r)}}}},843:function(e,t,n){"use strict";function o(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}t.__esModule=!0,t.AudioPlayer=void 0;var i=(0,n(36).createLogger)("AudioPlayer"),a=function(){function e(){var e=this;Byond.IS_LTE_IE9||(this.node=document.createElement("audio"),this.node.style.setProperty("display","none"),document.body.appendChild(this.node),this.playing=!1,this.volume=1,this.options={},this.onPlaySubscribers=[],this.onStopSubscribers=[],this.node.addEventListener("canplaythrough",(function(){i.log("canplaythrough"),e.playing=!0,e.node.playbackRate=e.options.pitch||1,e.node.currentTime=e.options.start||0,e.node.volume=e.volume,e.node.play();for(var t,n=o(e.onPlaySubscribers);!(t=n()).done;){(0,t.value)()}})),this.node.addEventListener("ended",(function(){i.log("ended"),e.stop()})),this.node.addEventListener("error",(function(t){e.playing&&(i.log("playback error",t.error),e.stop())})),this.playbackInterval=setInterval((function(){e.playing&&(e.options.end>0&&e.node.currentTime>=e.options.end&&e.stop())}),1e3))}var t=e.prototype;return t.destroy=function(){this.node&&(this.node.stop(),document.removeChild(this.node),clearInterval(this.playbackInterval))},t.play=function(e,t){void 0===t&&(t={}),this.node&&(i.log("playing",e,t),this.options=t,this.node.src=e)},t.stop=function(){if(this.node){if(this.playing)for(var e,t=o(this.onStopSubscribers);!(e=t()).done;)(0,e.value)();i.log("stopping"),this.playing=!1,this.node.src=""}},t.setVolume=function(e){this.node&&(this.volume=e,this.node.volume=e)},t.onPlay=function(e){this.onPlaySubscribers.push(e)},t.onStop=function(e){this.onStopSubscribers.push(e)},e}();t.AudioPlayer=a},844:function(e,t,n){"use strict";t.__esModule=!0,t.NowPlayingWidget=void 0;var o=n(1),r=n(17),i=n(32),a=n(2),c=n(365),s=n(446);t.NowPlayingWidget=function(e,t){var n,u=(0,i.useSelector)(t,s.selectAudio),l=(0,i.useDispatch)(t),d=(0,c.useSettings)(t),g=null==(n=u.meta)?void 0:n.title;return(0,o.createComponentVNode)(2,a.Flex,{mx:-.5,align:"center",children:[u.playing&&(0,o.createFragment)([(0,o.createComponentVNode)(2,a.Flex.Item,{shrink:0,mx:.5,color:"label",children:"Now playing:"}),(0,o.createComponentVNode)(2,a.Flex.Item,{mx:.5,grow:1,style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"},children:g||"Unknown Track"})],4)||(0,o.createComponentVNode)(2,a.Flex.Item,{grow:1,color:"label",children:"Nothing to play."}),u.playing&&(0,o.createComponentVNode)(2,a.Flex.Item,{mx:.5,fontSize:"0.9em",children:(0,o.createComponentVNode)(2,a.Button,{tooltip:"Stop",icon:"stop",onClick:function(){return l({type:"audio/stopMusic"})}})}),(0,o.createComponentVNode)(2,a.Flex.Item,{mx:.5,fontSize:"0.9em",children:(0,o.createComponentVNode)(2,a.Knob,{minValue:0,maxValue:1,value:d.adminMusicVolume,step:.0025,stepPixelSize:1,format:function(e){return(0,r.toFixed)(100*e)+"%"},onDrag:function(e,t){return d.update({adminMusicVolume:t})}})})]})}},845:function(e,t,n){"use strict";t.__esModule=!0,t.useSettings=void 0;var o=n(32),r=n(127),i=n(128);t.useSettings=function(e){var t=(0,o.useSelector)(e,i.selectSettings),n=(0,o.useDispatch)(e);return Object.assign({},t,{update:function(e){return n((0,r.updateSettings)(e))}})}},846:function(e,t,n){"use strict";t.__esModule=!0,t.settingsMiddleware=void 0;var o=n(124),r=n(847),i=n(127),a=n(128);t.settingsMiddleware=function(e){var t=!1;return function(n){return function(c){var s=c.type,u=c.payload;if(!t)return t=!0,o.storage.get("panel-settings").then((function(t){t&&(t.version?e.dispatch((0,i.loadSettings)(t)):o.storage.clear())})),n(c);if(s===i.updateSettings.type||s===i.loadSettings.type){var l=u.theme;return l&&(0,r.setClientTheme)(l),n(c),void o.storage.set("panel-settings",(0,a.selectSettings)(e.getState()))}return n(c)}}}},847:function(e,t,n){"use strict";t.__esModule=!0,t.setClientTheme=void 0;t.setClientTheme=function(e){if("light"===e)return Byond.winset({"infowindow.background-color":"none","infowindow.text-color":"#000000","info.background-color":"none","info.text-color":"#000000","browseroutput.background-color":"none","browseroutput.text-color":"#000000","outputwindow.background-color":"none","outputwindow.text-color":"#000000","mainwindow.background-color":"none","split.background-color":"none","changelog.background-color":"none","changelog.text-color":"#000000","rules.background-color":"none","rules.text-color":"#000000","wiki.background-color":"none","wiki.text-color":"#000000","forum.background-color":"none","forum.text-color":"#000000","github.background-color":"none","github.text-color":"#000000","report-issue.background-color":"none","report-issue.text-color":"#000000","output.background-color":"none","output.text-color":"#000000","statwindow.background-color":"none","statwindow.text-color":"#000000","stat.background-color":"#FFFFFF","stat.tab-background-color":"none","stat.text-color":"#000000","stat.tab-text-color":"#000000","stat.prefix-color":"#000000","stat.suffix-color":"#000000","saybutton.background-color":"none","saybutton.text-color":"#000000","oocbutton.background-color":"none","oocbutton.text-color":"#000000","mebutton.background-color":"none","mebutton.text-color":"#000000","asset_cache_browser.background-color":"none","asset_cache_browser.text-color":"#000000","tooltip.background-color":"none","tooltip.text-color":"#000000"});"dark"===e&&Byond.winset({"infowindow.background-color":"#202020","infowindow.text-color":"#a4bad6","info.background-color":"#202020","info.text-color":"#a4bad6","browseroutput.background-color":"#202020","browseroutput.text-color":"#a4bad6","outputwindow.background-color":"#202020","outputwindow.text-color":"#a4bad6","mainwindow.background-color":"#202020","split.background-color":"#202020","changelog.background-color":"#494949","changelog.text-color":"#a4bad6","rules.background-color":"#494949","rules.text-color":"#a4bad6","wiki.background-color":"#494949","wiki.text-color":"#a4bad6","forum.background-color":"#494949","forum.text-color":"#a4bad6","github.background-color":"#3a3a3a","github.text-color":"#a4bad6","report-issue.background-color":"#492020","report-issue.text-color":"#a4bad6","output.background-color":"#171717","output.text-color":"#a4bad6","statwindow.background-color":"#171717","statwindow.text-color":"#a4bad6","stat.background-color":"#171717","stat.tab-background-color":"#202020","stat.text-color":"#a4bad6","stat.tab-text-color":"#a4bad6","stat.prefix-color":"#a4bad6","stat.suffix-color":"#a4bad6","saybutton.background-color":"#202020","saybutton.text-color":"#a4bad6","oocbutton.background-color":"#202020","oocbutton.text-color":"#a4bad6","mebutton.background-color":"#202020","mebutton.text-color":"#a4bad6","asset_cache_browser.background-color":"#202020","asset_cache_browser.text-color":"#a4bad6","tooltip.background-color":"#202020","tooltip.text-color":"#a4bad6"})}},848:function(e,t,n){"use strict";t.__esModule=!0,t.settingsReducer=void 0;var o={version:n(849).SETTINGS_VERSION,fontSize:13,lineHeight:1.2,theme:"light",adminMusicVolume:.5,highlightText:"",highlightColor:"#ffdd44"};t.settingsReducer=function(e,t){void 0===e&&(e=o);var n=t.type,r=t.payload;if("settings/update"===n)return Object.assign({},e,r);if("settings/load"===n){var i=r;return Object.assign({},e,{fontSize:i.fontSize,lineHeight:i.lineHeight,theme:i.theme,adminMusicVolume:i.adminMusicVolume,highlightText:i.highlightText,highlightColor:i.highlightColor})}return e}},849:function(e,t,n){"use strict";t.__esModule=!0,t.SETTINGS_VERSION=void 0;t.SETTINGS_VERSION=1},850:function(e,t,n){"use strict";t.__esModule=!0,t.SettingsGeneral=t.SettingsPanel=void 0;var o=n(1),r=n(17),i=n(32),a=n(3),c=n(2),s=n(129),u=n(127),l=n(128),d=["light","dark"],g=[{name:"General",component:function(){return p}},{name:"Chat Tabs",component:function(){return h}}];t.SettingsPanel=function(e,t){var n,r=(0,a.useLocalState)(t,"settingsTab",g[0].name),i=r[0],s=r[1],u=null==(n=g.find((function(e){return e.name===i})))?void 0:n.component();return(0,o.createComponentVNode)(2,c.Flex,{children:[(0,o.createComponentVNode)(2,c.Flex.Item,{mr:1,children:(0,o.createComponentVNode)(2,c.Section,{fitted:!0,fill:!0,minHeight:"8em",children:(0,o.createComponentVNode)(2,c.Tabs,{vertical:!0,children:g.map((function(e){return(0,o.createComponentVNode)(2,c.Tabs.Tab,{selected:e.name===i,onClick:function(){return s(e.name)},children:e.name},e.name)}))})})}),(0,o.createComponentVNode)(2,c.Flex.Item,{grow:1,basis:0,children:(0,o.createComponentVNode)(2,u)})]})};var p=function(e,t){var n=(0,i.useSelector)(t,l.selectSettings),a=n.theme,g=n.fontSize,p=n.lineHeight,h=n.highlightText,f=n.highlightColor,m=(0,i.useDispatch)(t);return(0,o.createComponentVNode)(2,c.Section,{fill:!0,children:[(0,o.createComponentVNode)(2,c.LabeledList,{children:[(0,o.createComponentVNode)(2,c.LabeledList.Item,{label:"Theme",children:(0,o.createComponentVNode)(2,c.Dropdown,{selected:a,options:d,onSelected:function(e){return m((0,u.updateSettings)({theme:e}))}})}),(0,o.createComponentVNode)(2,c.LabeledList.Item,{label:"Font size",children:(0,o.createComponentVNode)(2,c.NumberInput,{width:"4em",step:1,stepPixelSize:10,minValue:8,maxValue:48,value:g,unit:"px",format:function(e){return(0,r.toFixed)(e)},onChange:function(e,t){return m((0,u.updateSettings)({fontSize:t}))}})}),(0,o.createComponentVNode)(2,c.LabeledList.Item,{label:"Line height",children:(0,o.createComponentVNode)(2,c.NumberInput,{width:"4em",step:.01,stepPixelSize:2,minValue:.8,maxValue:5,value:p,format:function(e){return(0,r.toFixed)(e,2)},onDrag:function(e,t){return m((0,u.updateSettings)({lineHeight:t}))}})})]}),(0,o.createComponentVNode)(2,c.Divider),(0,o.createComponentVNode)(2,c.Box,{children:[(0,o.createComponentVNode)(2,c.Flex,{mb:1,color:"label",align:"baseline",children:[(0,o.createComponentVNode)(2,c.Flex.Item,{grow:1,children:"Highlight words (comma separated):"}),(0,o.createComponentVNode)(2,c.Flex.Item,{shrink:0,children:[(0,o.createComponentVNode)(2,c.ColorBox,{mr:1,color:f}),(0,o.createComponentVNode)(2,c.Input,{width:"5em",monospace:!0,placeholder:"#ffffff",value:f,onInput:function(e,t){return m((0,u.updateSettings)({highlightColor:t}))}})]})]}),(0,o.createComponentVNode)(2,c.TextArea,{height:"3em",value:h,onChange:function(e,t){return m((0,u.updateSettings)({highlightText:t}))}})]}),(0,o.createComponentVNode)(2,c.Divider),(0,o.createComponentVNode)(2,c.Box,{children:[(0,o.createComponentVNode)(2,c.Button,{icon:"check",onClick:function(){return m((0,s.rebuildChat)())},children:"Apply now"}),(0,o.createComponentVNode)(2,c.Box,{inline:!0,fontSize:"0.9em",ml:1,color:"label",children:"Can freeze the chat for a while."})]})]})};t.SettingsGeneral=p;var h=function(e,t){return(0,o.createComponentVNode)(2,c.Section,{fill:!0,children:"COMING SOON\u2122"})}},851:function(e,t,n){"use strict";t.__esModule=!0,t.audioReducer=void 0;var o={playing:!1,track:null};t.audioReducer=function(e,t){void 0===e&&(e=o);var n=t.type,r=t.payload;return"audio/playing"===n?Object.assign({},e,{playing:!0}):"audio/stopped"===n?Object.assign({},e,{playing:!1}):"audio/playMusic"===n?Object.assign({},e,{meta:r}):"audio/stopMusic"===n?Object.assign({},e,{playing:!1,meta:null}):e}},852:function(e,t,n){"use strict";t.__esModule=!0,t.ChatPanel=void 0;var o=n(1),r=n(10),i=n(2),a=n(448);var c=function(e){var t,n;function c(){var t;return(t=e.call(this)||this).ref=(0,o.createRef)(),t.state={scrollTracking:!0},t.handleScrollTrackingChange=function(e){return t.setState({scrollTracking:e})},t}n=e,(t=c).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var s=c.prototype;return s.componentDidMount=function(){a.chatRenderer.mount(this.ref.current),a.chatRenderer.events.on("scrollTrackingChanged",this.handleScrollTrackingChange),this.componentDidUpdate()},s.componentWillUnmount=function(){a.chatRenderer.events.off("scrollTrackingChanged",this.handleScrollTrackingChange)},s.componentDidUpdate=function(e){requestAnimationFrame((function(){a.chatRenderer.ensureScrollTracking()})),(!e||(0,r.shallowDiffers)(this.props,e))&&a.chatRenderer.assignStyle({width:"100%",whiteSpace:"pre-wrap",fontSize:this.props.fontSize,lineHeight:this.props.lineHeight})},s.render=function(){var e=this.state.scrollTracking;return(0,o.createFragment)([(0,o.createVNode)(1,"div","Chat",null,1,null,null,this.ref),!e&&(0,o.createComponentVNode)(2,i.Button,{className:"Chat__scrollButton",icon:"arrow-down",onClick:function(){return a.chatRenderer.scrollToBottom()},children:"Scroll to bottom"})],0)},c}(o.Component);t.ChatPanel=c},853:function(e,t,n){"use strict";t.__esModule=!0,t.createUuid=void 0;t.createUuid=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))}},854:function(e,t,n){"use strict";function o(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}t.__esModule=!0,t.highlightNode=void 0;t.highlightNode=function a(e,t,n){for(var r,c=0,s=o(e.childNodes);!(r=s()).done;){var u=r.value;3===u.nodeType?c+=i(u,t,n):c+=a(u,t,n)}return c};var i=function(e,t,n){for(var o,r,i=e.textContent,a=i.length,c=0,s=0;o=t.exec(i);){s+=1,r||(r=document.createDocumentFragment());var u=o[0],l=u.length,d=o.index;if(c<d&&r.appendChild(document.createTextNode(i.substring(c,d))),c=d+l,n)r.appendChild(n(u));else{var g=document.createElement("span");g.setAttribute("style","background-color:#fd4;color:#000"),g.textContent=u,r.appendChild(g)}}return r&&(c<a&&r.appendChild(document.createTextNode(i.substring(c,a))),e.parentNode.replaceChild(r,e)),s}},855:function(e,t,n){"use strict";t.__esModule=!0,t.ChatTabs=void 0;var o=n(1),r=n(32),i=n(2),a=n(129),c=n(130);t.ChatTabs=function(e,t){var n=(0,r.useSelector)(t,c.selectChatPages),s=(0,r.useSelector)(t,c.selectCurrentChatPage),u=(0,r.useDispatch)(t);return(0,o.createComponentVNode)(2,i.Tabs,{textAlign:"center",children:n.map((function(e){return(0,o.createComponentVNode)(2,i.Tabs.Tab,{selected:e===s,rightSlot:(0,o.createComponentVNode)(2,i.Box,{fontSize:"0.9em",children:e.count}),onClick:function(){return u((0,a.changeChatPage)(e))},children:e.name},e.id)}))})}},856:function(e,t,n){"use strict";t.__esModule=!0,t.chatMiddleware=void 0;var o=n(124),r=n(36),i=n(127),a=n(128),c=n(129),s=n(366),u=n(448),l=n(130);function d(e,t,n,o,r,i,a){try{var c=e[i](a),s=c.value}catch(u){return void n(u)}c.done?t(s):Promise.resolve(s).then(o,r)}function g(e){return function(){var t=this,n=arguments;return new Promise((function(o,r){var i=e.apply(t,n);function a(e){d(i,o,r,a,c,"next",e)}function c(e){d(i,o,r,a,c,"throw",e)}a(undefined)}))}}(0,r.createLogger)("chat/middleware");var p=function(){var e=g(regeneratorRuntime.mark((function t(e){var n,r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=(0,l.selectChat)(e.getState()),r=Math.max(0,u.chatRenderer.messages.length-s.MAX_PERSISTED_MESSAGES),i=u.chatRenderer.messages.slice(r).filter((function(e){return"internal"!==e.type})).map((function(e){return(0,u.serializeMessage)(e)})),o.storage.set("chat-state",n),o.storage.set("chat-messages",i);case 5:case"end":return t.stop()}}),t)})));return function(t){return e.apply(this,arguments)}}(),h=function(){var e=g(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o.storage.get("chat-state").then((function(t){t&&e.dispatch((0,c.loadChat)(t))})),o.storage.get("chat-messages").then((function(e){if(e){var t=[].concat(e,[(0,u.createMessage)({type:"internal/reconnected"})]);u.chatRenderer.processBatch(t,{prepend:!0})}}));case 2:case"end":return t.stop()}}),t)})));return function(t){return e.apply(this,arguments)}}();t.chatMiddleware=function(e){var t=!1;return u.chatRenderer.events.on("batchProcessed",(function(t){e.dispatch((0,c.updateMessageCount)(t))})),setInterval((function(){return p(e)}),s.MESSAGE_SAVE_INTERVAL),function(n){return function(o){var r=o.type,s=o.payload;if(!t)return t=!0,h(e),n(o);if("chat/message"!==r){if(r===c.changeChatPage.type){var l=s;return u.chatRenderer.changePage(l),n(o)}if(r===c.rebuildChat.type)return u.chatRenderer.rebuildChat(),n(o);if(r!==i.updateSettings.type&&r!==i.loadSettings.type)return"roundrestart"===r?(p(e),n(o)):n(o);n(o);var d=(0,a.selectSettings)(e.getState());u.chatRenderer.setHighlight(d.highlightText,d.highlightColor)}else{var g=Array.isArray(s)?s:[s];u.chatRenderer.processBatch(g)}}}}},857:function(e,t,n){"use strict";t.__esModule=!0,t.chatReducer=t.initialState=void 0;var o,r=n(21),i=n(129),a=n(366),c=n(130);function s(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var l={currentPage:a.DEFAULT_PAGE.id,pageById:(o={},o[a.DEFAULT_PAGE.id]=a.DEFAULT_PAGE,o)};t.initialState=l;t.chatReducer=function(e,t){void 0===e&&(e=l);var n=t.type,o=t.payload;if(n===i.changeChatPage.type){var a=o;return Object.assign({},e,{currentPage:a.id})}if(n===i.updateMessageCount.type){for(var u,d=o,g=(0,r.toArray)(e.pageById),p=Object.assign({},e.pageById),h=s(g);!(u=h()).done;){for(var f=u.value,m=f.count||0,v=0,b=Object.keys(d);v<b.length;v++){var y=b[v];(0,c.canPageAcceptType)(f,y)&&(m+=d[y])}f.count!==m&&(p[f.id]=Object.assign({},f,{count:m}))}return Object.assign({},e,{pageById:p})}return e}},858:function(e,t,n){"use strict";(function(e){t.__esModule=!0,t.setupPanelFocusHacks=void 0;var o=n(125),r=n(75),i=n(352),a=function(){return e((function(){return(0,i.focusMap)()}))};t.setupPanelFocusHacks=function(){var e=!1,t=null;window.addEventListener("focusin",(function(t){e=(0,r.canStealFocus)(t.target)})),window.addEventListener("mousedown",(function(e){t=[e.screenX,e.screenY]})),window.addEventListener("mouseup",(function(n){if(t){var r=[n.screenX,n.screenY];(0,o.vecLength)((0,o.vecSubtract)(r,t))>=10&&(e=!0)}e||a()})),r.globalEvents.on("keydown",(function(e){e.isModifierKey()||a()}))}}).call(this,n(358).setImmediate)},859:function(e,t,n){"use strict";t.__esModule=!0,t.useGame=void 0;var o=n(32),r=n(450);t.useGame=function(e){return(0,o.useSelector)(e,r.selectGame)}},860:function(e,t,n){"use strict";t.__esModule=!0,t.gameMiddleware=void 0;var o=n(367),r=n(451),i=n(450),a=n(861),c=function(e){return Object.assign({},e,{meta:Object.assign({},e.meta,{now:Date.now()})})};t.gameMiddleware=function(e){var t;return setInterval((function(){var n=e.getState();if(n){var o=(0,i.selectGame)(n),s=t&&Date.now()>=t+a.CONNECTION_LOST_AFTER;!o.connectionLostAt&&s&&e.dispatch(c((0,r.connectionLost)())),o.connectionLostAt&&!s&&e.dispatch(c((0,r.connectionRestored)()))}}),1e3),function(e){return function(n){var i=n.type,a=(n.payload,n.meta);return i===o.pingSuccess.type?(t=a.now,e(n)):i===r.roundRestarted.type?e(c(n)):e(n)}}}},861:function(e,t,n){"use strict";t.__esModule=!0,t.CONNECTION_LOST_AFTER=void 0;t.CONNECTION_LOST_AFTER=15e3},862:function(e,t,n){"use strict";t.__esModule=!0,t.gameReducer=void 0;var o=n(451),r={roundId:null,roundTime:null,roundRestartedAt:null,connectionLostAt:null};t.gameReducer=function(e,t){void 0===e&&(e=r);var n=t.type,i=(t.payload,t.meta);return"roundrestart"===n?Object.assign({},e,{roundRestartedAt:i.now}):n===o.connectionLost.type?Object.assign({},e,{connectionLostAt:i.now}):n===o.connectionRestored.type?Object.assign({},e,{connectionLostAt:null}):e}},863:function(e,t,n){"use strict";t.__esModule=!0,t.pingMiddleware=void 0;var o=n(3),r=n(367),i=n(453);t.pingMiddleware=function(e){var t=!1,n=0,a=[],c=function(){for(var t=0;t<i.PING_QUEUE_SIZE;t++){var c=a[t];c&&Date.now()-c.sentAt>i.PING_TIMEOUT&&(a[t]=null,e.dispatch((0,r.pingFail)()))}var s={index:n,sentAt:Date.now()};a[n]=s,(0,o.sendMessage)({type:"ping",payload:{index:n}}),n=(n+1)%i.PING_QUEUE_SIZE};return function(e){return function(n){var o=n.type,s=n.payload;if(t||(t=!0,setInterval(c,i.PING_INTERVAL),c()),"pingReply"===o){var u=s.index,l=a[u];if(!l)return;return a[u]=null,e((0,r.pingSuccess)(l))}return e(n)}}}},864:function(e,t,n){"use strict";t.__esModule=!0,t.PingIndicator=void 0;var o=n(1),r=n(865),i=n(17),a=n(32),c=n(2),s=n(866);t.PingIndicator=function(e,t){var n=(0,a.useSelector)(t,s.selectPing),u=r.Color.lookup(n.networkQuality,[new r.Color(220,40,40),new r.Color(220,200,40),new r.Color(60,220,40)]),l=n.roundtrip?(0,i.toFixed)(n.roundtrip):"--";return(0,o.createVNode)(1,"div","Ping",[(0,o.createComponentVNode)(2,c.Box,{className:"Ping__indicator",backgroundColor:u}),l],0)}},865:function(e,t,n){"use strict";t.__esModule=!0,t.Color=void 0;var o=function(){function e(e,t,n,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===o&&(o=1),Object.assign(this,{r:e,g:t,b:n,a:o})}return e.prototype.toString=function(){return"rgba("+(0|this.r)+", "+(0|this.g)+", "+(0|this.b)+", "+(0|this.a)+")"},e}();t.Color=o,o.fromHex=function(e){return new o(parseInt(e.substr(1,2),16),parseInt(e.substr(3,2),16),parseInt(e.substr(5,2),16))},o.lerp=function(e,t,n){return new o((t.r-e.r)*n+e.r,(t.g-e.g)*n+e.g,(t.b-e.b)*n+e.b,(t.a-e.a)*n+e.a)},o.lookup=function(e,t){void 0===t&&(t=[]);var n=t.length;if(n<2)throw new Error("Needs at least two colors!");var r=e*(n-1);if(e<1e-4)return t[0];if(e>=.9999)return t[n-1];var i=r%1,a=0|r;return o.lerp(t[a],t[a+1],i)}},866:function(e,t,n){"use strict";t.__esModule=!0,t.selectPing=void 0;t.selectPing=function(e){return e.ping}},867:function(e,t,n){"use strict";t.__esModule=!0,t.pingReducer=void 0;var o=n(17),r=n(367),i=n(453);t.pingReducer=function(e,t){void 0===e&&(e={});var n=t.type,a=t.payload;if(n===r.pingSuccess.type){var c=a.roundtrip,s=e.roundtripAvg||c,u=Math.round(.4*s+.6*c);return{roundtrip:c,roundtripAvg:u,failCount:0,networkQuality:1-(0,o.scale)(u,i.PING_ROUNDTRIP_BEST,i.PING_ROUNDTRIP_WORST)}}if(n===r.pingFail.type){var l=e.failCount,d=void 0===l?0:l,g=(0,o.clamp01)(e.networkQuality-d/i.PING_MAX_FAILS),p=Object.assign({},e,{failCount:d+1,networkQuality:g});return d>i.PING_MAX_FAILS&&(p.roundtrip=undefined,p.roundtripAvg=undefined),p}return e}},868:function(e,t,n){"use strict";t.__esModule=!0,t.telemetryMiddleware=void 0;var o=n(3),r=n(124);function i(e,t,n,o,r,i,a){try{var c=e[i](a),s=c.value}catch(u){return void n(u)}c.done?t(s):Promise.resolve(s).then(o,r)}var a=(0,n(36).createLogger)("telemetry");t.telemetryMiddleware=function(e){var t,n;return function(c){return function(s){var u,l=s.type,d=s.payload;if("telemetry/request"!==l)return"backend/update"===l?(c(s),void(u=regeneratorRuntime.mark((function h(){var o,i,c,s;return regeneratorRuntime.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:if(i=null==d||null==(o=d.config)?void 0:o.client){u.next=4;break}return a.error("backend/update payload is missing client data!"),u.abrupt("return");case 4:if(t){u.next=13;break}return u.next=7,r.storage.get("telemetry");case 7:if(u.t0=u.sent,u.t0){u.next=10;break}u.t0={};case 10:(t=u.t0).connections||(t.connections=[]),a.debug("retrieved telemetry from storage",t);case 13:c=!1,t.connections.find((function(e){return n=i,(t=e).ckey===n.ckey&&t.address===n.address&&t.computer_id===n.computer_id;var t,n}))||(c=!0,t.connections.unshift(i),t.connections.length>10&&t.connections.pop()),c&&(a.debug("saving telemetry to storage",t),r.storage.set("telemetry",t)),n&&(s=n,n=null,e.dispatch({type:"telemetry/request",payload:s}));case 18:case"end":return u.stop()}}),h)})),function(){var e=this,t=arguments;return new Promise((function(n,o){var r=u.apply(e,t);function a(e){i(r,n,o,a,c,"next",e)}function c(e){i(r,n,o,a,c,"throw",e)}a(undefined)}))})()):c(s);if(!t)return a.debug("deferred"),void(n=d);a.debug("sending");var g=(null==d?void 0:d.limits)||{},p=t.connections.slice(0,g.connections);(0,o.sendMessage)({type:"telemetry",payload:{connections:p}})}}}},869:function(e,t,n){"use strict";t.__esModule=!0,t.Panel=void 0;var o=n(1),r=(n(32),n(3)),i=n(2),a=n(4),c=n(445),s=n(447),u=n(449),l=n(870),d=n(452),g=n(365);t.Panel=function(e,t){var n=(0,c.useAudio)(t),p=(0,g.useSettings)(t),h=(0,u.useGame)(t),f=(0,r.useLocalState)(t,"audioOpen",n.playing),m=f[0],v=f[1],b=(0,r.useLocalState)(t,"settingsOpen",!1),y=b[0],_=b[1];return(0,o.createComponentVNode)(2,a.Pane,{theme:p.theme,fontSize:p.fontSize+"px",children:(0,o.createComponentVNode)(2,i.Flex,{direction:"column",height:"100%",children:[(0,o.createComponentVNode)(2,i.Flex.Item,{children:(0,o.createComponentVNode)(2,i.Section,{fitted:!0,children:(0,o.createComponentVNode)(2,i.Flex,{mx:.5,align:"center",children:[(0,o.createComponentVNode)(2,i.Flex.Item,{mx:.5,grow:1,children:(0,o.createComponentVNode)(2,s.ChatTabs)}),(0,o.createComponentVNode)(2,i.Flex.Item,{mx:.5,children:(0,o.createComponentVNode)(2,d.PingIndicator)}),(0,o.createComponentVNode)(2,i.Flex.Item,{mx:.5,children:(0,o.createComponentVNode)(2,i.Button,{color:"grey",selected:m||n.playing,icon:"music",onClick:function(){return v(!m)}})}),(0,o.createComponentVNode)(2,i.Flex.Item,{mx:.5,children:(0,o.createComponentVNode)(2,i.Button,{icon:"cog",selected:y,onClick:function(){return _(!y)}})})]})})}),m&&(0,o.createComponentVNode)(2,i.Flex.Item,{mt:1,children:(0,o.createComponentVNode)(2,i.Section,{children:(0,o.createComponentVNode)(2,c.NowPlayingWidget)})}),y&&(0,o.createComponentVNode)(2,i.Flex.Item,{mt:1,children:(0,o.createComponentVNode)(2,g.SettingsPanel)}),(0,o.createComponentVNode)(2,i.Flex.Item,{mt:1,grow:1,children:(0,o.createComponentVNode)(2,i.Section,{fill:!0,fitted:!0,position:"relative",children:[(0,o.createComponentVNode)(2,a.Pane.Content,{scrollable:!0,children:(0,o.createComponentVNode)(2,s.ChatPanel,{lineHeight:p.lineHeight})}),(0,o.createComponentVNode)(2,l.Notifications,{children:[h.connectionLostAt&&(0,o.createComponentVNode)(2,l.Notifications.Item,{rightSlot:(0,o.createComponentVNode)(2,i.Button,{color:"white",onClick:function(){return Byond.command(".reconnect")},children:"Reconnect"}),children:"You are either AFK, experiencing lag or the connection has closed."}),h.roundRestartedAt&&(0,o.createComponentVNode)(2,l.Notifications.Item,{children:"The connection has been closed because the server is restarting. Please wait while you automatically reconnect."})]})]})})]})})}},870:function(e,t,n){"use strict";t.__esModule=!0,t.Notifications=void 0;var o=n(1),r=n(2),i=function(e){var t=e.children;return(0,o.createVNode)(1,"div","Notifications",t,0)};t.Notifications=i;i.Item=function(e){var t=e.rightSlot,n=e.children;return(0,o.createComponentVNode)(2,r.Flex,{align:"center",className:"Notification",children:[(0,o.createComponentVNode)(2,r.Flex.Item,{className:"Notification__content",grow:1,children:n}),t&&(0,o.createComponentVNode)(2,r.Flex.Item,{className:"Notification__rightSlot",children:t})]})}}});