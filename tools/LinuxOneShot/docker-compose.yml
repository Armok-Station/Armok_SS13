version: '3.7'
services:
  mariadb:
    image: mariadb
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: YouDefinitelyShouldNOTChangeThis
      MYSQL_INITDB_SKIP_TZINFO: 1
    ports:
      - "3306:3306"
      volumes:
        - "./Database:/var/lib/mysql"
    logging:
      driver: none
  tgs:
    cap_add:
      - SYS_NICE
    image: "tgstation/server:latest"
    depends_on:
      - mariadb
    ports:
      - "1337:1337"
      - "5000:80"
    restart: always
    init: true
    environment:
      TGS_SCHEMA_FILE: SQL/tgstation_schema.sql
      TGS_DB_ADMIN_CKEY: <YOUR BYOND USERNAME HERE>
    volumes:
      - "./TGS_Logs:/tgs_logs"
      - "./TGS_Config:/config_data"
      - "./TGS_Instances:/tgs4_instances"
    logging:
      driver: none
  setup:
    environment:
      TGS_BYOND: 513.1514
      TGS_REPO: https://github.com/tgstation/tgstation
    build:
      context: ./SetupProgram
      dockerfile: Dockerfile
    depends_on:
      - tgs
      - mariadb
    restart: "no"
