/**
 * @file
 * @copyright 2024 Aylong (https://github.com/AyIong)
 * @license MIT
 */

@use '../base.scss';
@use '../colors.scss';
@use '../functions.scss' as *;
@use './Divider.scss';

$color-default: colors.bg(base.$color-bg-section) !default;
$color-disabled: #631d1d !default;
$color-selected: colors.bg(colors.$green) !default;
$color-content: colors.$primary !default;
$bg-map: colors.$bg-map !default;

@mixin button-style(
  $color,
  $border-color: rgba(lighten($color, 50%), 0.2),
  $border-width: 1px 0 0 0,
  $opacity: 0.2,
  $hoverable: true,
  $transition-duration: 0.2s
) {
  $luminance: luminance($color);
  $text-color: if($luminance > 0.3, rgba(0, 0, 0, 1), rgba(255, 255, 255, 1));

  background-color: rgba($color, $opacity);
  color: $text-color;
  border: solid $border-color;
  border-width: $border-width;
  transition:
    background-color $transition-duration,
    border-color $transition-duration;

  @if $hoverable {
    &:hover {
      background-color: rgba(lighten($color, 50%), $opacity);
    }
  }
}

@each $color-name, $color-value in $bg-map {
  .ImageButton--color--#{$color-name} {
    @include button-style($color-value, $border-width: 1px);
  }

  .ImageButton__content--color--#{$color-name} {
    @include button-style(
      $color-value,
      $border-color: lighten($color-value, 25%),
      $opacity: 1,
      $hoverable: false
    );
  }
}

.ImageButton {
  &--color--default {
    @include button-style(lighten($color-default, 85%), $border-width: 1px);
  }

  &--disabled {
    background-color: rgba($color-disabled, 0.25) !important;
    border-color: rgba($color-disabled, 0.25) !important;
  }

  &--selected {
    @include button-style(
      $color-selected,
      $border-color: rgba($color-selected, 0.25),
      $border-width: 1px
    );
  }
}

.ImageButton__content {
  &--color--default {
    @include button-style(
      lighten($color-default, 80%),
      $border-color: lighten($color-default, 100%),
      $opacity: 1,
      $hoverable: false
    );
  }

  &--disabled {
    background-color: $color-disabled !important;
    border-top: 1px solid lighten($color-disabled, 25%) !important;
  }

  &--selected {
    @include button-style(
      $color-selected,
      $border-color: lighten($color-selected, 25%),
      $opacity: 1,
      $hoverable: false
    );
  }
}

@each $color-name, $color-value in $bg-map {
  .ImageButton__buttons--color--#{$color-name} {
    @include button-style(
      $color-value,
      $border-width: 1px 1px 1px 0,
      $hoverable: false,
      $transition-duration: 0
    );
  }
}

.ImageButton__buttons--color--default {
  @include button-style(
    lighten($color-default, 85%),
    $border-width: 1px 1px 1px 0,
    $hoverable: false,
    $transition-duration: 0
  );
}

.ImageButton {
  display: inline-table;
  position: relative;
  text-align: center;
  margin: 0.25em;

  &--noAction {
    pointer-events: none;
  }

  &__container {
    display: flex;
    flex-direction: column;
    border-radius: 0.33em;
  }

  &__image {
    position: relative;
    align-self: center;
    line-height: 0;
    padding: 0.25em;
  }

  &__buttons {
    display: flex;
    position: absolute;
    overflow: hidden;
    left: 1px;
    bottom: 1.8em;
    max-width: 100%;

    &--alt {
      overflow: visible;
      flex-direction: column;
      pointer-events: none;
      top: 1px;
      bottom: inherit !important;
    }

    &--noContent {
      bottom: 1px;
    }

    & > * {
      /* I know !important is bad, but here's no other way */
      margin: 0 !important;
      border-radius: 0 !important;
      transition-duration: 0.2s !important;
    }
  }

  &__content {
    -ms-user-select: none;
    user-select: none;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    padding: 0.25em 0.5em;
    margin: -1px;
    border-radius: 0 0 0.33em 0.33em;
  }
}

.ImageButton__fluid {
  display: flex;
  flex-direction: row;
  position: relative;
  text-align: center;
  margin-bottom: 0.5em;

  &:last-child {
    margin-bottom: 0;
  }

  &--info {
    display: flex;
    flex-direction: column;
    justify-content: center;
    flex: 1;
    -ms-user-select: none;
    user-select: none;
    margin: 0 0.5em;
  }

  &--title {
    font-weight: bold;
    padding: 0.5em;

    &--divider {
      border-bottom: Divider.$thickness solid Divider.$color;
    }
  }

  &--content {
    display: flex;
    justify-content: space-between;
    padding: 0.5em;
    color: white;
  }

  .ImageButton {
    &__container {
      flex-direction: row;
      flex: 1;

      &--hasButtons {
        border-radius: 0.33em 0 0 0.33em;
      }
    }

    &__image {
      padding: 0;
    }

    &__buttons {
      position: relative;
      left: inherit;
      bottom: inherit;
      border-radius: 0 0.33em 0.33em 0;

      &--alt {
        overflow: hidden;
      }

      & > * {
        display: inline-flex;
        flex-direction: column;
        justify-content: center;
        text-align: center;
        white-space: pre-wrap;
        line-height: base.em(14px);
        border-left: 1px solid rgba(255, 255, 255, 0.075);
      }

      &--alt {
        flex-direction: column;
        top: inherit;

        & > * {
          height: 100%;
          border-left: 1px solid rgba(255, 255, 255, 0.075);
          border-top: 1px solid rgba(255, 255, 255, 0.075);

          &:first-child {
            border-top: 0;
          }
        }
      }
    }
  }
}
