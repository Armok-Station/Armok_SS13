/**
 * @file
 * @copyright 2024 Aylong (https://github.com/AyIong)
 * @license MIT
 */

@use '../base.scss';
@use '../colors.scss';
@use '../functions.scss' as *;
@use './Divider.scss';

$color-default: colors.bg(base.$color-bg-section) !default;
$color-disabled: #631d1d !default;
$color-selected: colors.bg(colors.$green) !default;
$color-content: colors.$primary !default;
$bg-map: colors.$bg-map !default;

@mixin button-style(
  $color,
  $border-color: rgba(lighten($color, 50%), 0.2),
  $border-width: 1px 0 0 0,
  $opacity: 0.15,
  $hoverable: true
) {
  $luminance: luminance($color);
  $text-color: if($luminance > 0.4, rgba(0, 0, 0, 1), rgba(255, 255, 255, 1));

  background-color: rgba($color, $opacity);
  color: $text-color;
  border: solid $border-color;
  border-width: $border-width;
  transition: background-color 0.2s;

  @if $hoverable {
    &:hover {
      background-color: rgba(lighten($color, 50%), $opacity);
    }
  }
}

@each $color-name, $color-value in $bg-map {
  .ImageButton--color--#{$color-name} {
    @include button-style($color-value, $border-width: 1px);
  }

  .ImageButton__content--color--#{$color-name} {
    @include button-style(
      $color-value,
      $border-color: lighten($color-value, 25%),
      $opacity: 1,
      $hoverable: false
    );
  }
}

.ImageButton {
  &--color--default {
    @include button-style(lighten($color-default, 85%), $border-width: 1px);
  }

  &--disabled {
    background-color: rgba($color-disabled, 0.25) !important;
    border-color: rgba($color-disabled, 0.25) !important;
  }

  &--selected {
    @include button-style(
      $color-selected,
      $border-color: rgba($color-selected, 0.25),
      $border-width: 1px
    );
  }
}

.ImageButton__content {
  &--color--default {
    @include button-style(
      $color-content,
      $border-color: lighten($color-content, 25%),
      $opacity: 1,
      $hoverable: false
    );
  }

  &--disabled {
    background-color: $color-disabled !important;
    border-top: 1px solid lighten($color-disabled, 25%) !important;
  }

  &--selected {
    @include button-style(
      $color-selected,
      $border-color: lighten($color-selected, 25%),
      $opacity: 1,
      $hoverable: false
    );
  }
}

.ImageButton {
  display: inline-block;
  position: relative;
  margin: 0.25em;

  &__container {
    display: flex;
    flex-direction: column;
  }

  &__image {
    position: relative;
    align-self: center;
    line-height: 0;
    padding: 0.25em;
  }

  &__buttons {
    display: flex;
    position: absolute;
    overflow: hidden;
    left: 1px;
    bottom: 1.6em;
    max-width: 100%;

    &--noContent {
      bottom: 1px;
    }

    & > * {
      margin: 0 !important;
      border-radius: 0 !important;
    }
  }

  &__content {
    -ms-user-select: none;
    user-select: none;
    overflow: hidden;
    text-overflow: ellipsis;
    text-align: center;
    white-space: nowrap;
    padding: 0.15em 0.25em;
    margin: -1px;
  }
}

.ImageButton__fluid {
  display: flex;
  flex-direction: row;
  position: relative;
  margin-bottom: 0.5em;

  &:last-child {
    margin-bottom: 0;
  }

  &--info {
    display: flex;
    flex-direction: column;
    justify-content: center;
    flex: 1;
    -ms-user-select: none;
    user-select: none;
    text-align: center;
    margin: 0 0.5em;
  }

  &--title {
    font-weight: bold;
    padding: 0.5em;

    &:last-child {
      padding: 0 0.5em;
    }

    &--divider {
      border-bottom: Divider.$thickness solid Divider.$color;
    }
  }

  &--content {
    padding: 0.5em;
  }

  .ImageButton {
    &__container {
      flex-direction: row;
      flex: 1;
    }

    &__image {
      padding: 0;
    }

    &__buttons {
      flex-direction: column;
      right: 0;
      left: inherit;
      bottom: inherit;
      height: 100%;

      & > * {
        display: inline-flex;
        height: 100%;
        flex-direction: column;
        justify-content: center;
        text-align: center;
        border-left: 1px solid rgba(255, 255, 255, 0.2);
        border-top: 1px solid rgba(255, 255, 255, 0.2);

        &:first-child {
          border-top: 0;
        }
      }
    }
  }
}
