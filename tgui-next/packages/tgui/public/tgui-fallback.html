<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta charset="utf-8">

<!-- Styles -->
<link rel="stylesheet" type="text/css" href="tgui.css">

<!-- This is processed in byond, so interfaces can override the
  html head if needed, for custom sheets of style etc. -->
<!--customheadhtml-->
<script id="data" type="application/json" data-ref="[ref]">{}</script>

</head>
<body class="">

<!-- Old TGUI container -->
<div id="container" class="container">
  <div class="notice">
    <span>Loading...</span><br>
  </div>
</div>

<!-- Error container -->
<div id="error-container"></div>

<!-- Scripts -->
<script type="text/javascript">
// Fill ref with data from query params
var ref = location.search.replace('?ref=', '');
document.getElementById('data').setAttribute('data-ref', ref);
// Early global error handling
window.onerror = function (msg, url, line, col, error) {
  var logString = msg + ' (' + url + ' line ' + line + ')';
  // Print to the page
  document.getElementById('error-container').innerHTML = logString;
  // Send to the backend
  var ref = document.getElementById('data').getAttribute('data-ref');
  location.href = 'byond://?src=' + ref
    + '&action=tgui:log&error=true'
    + '&log=' + encodeURIComponent(logString
      + '\nUser Agent: ' + navigator.userAgent);
};
// Subscribe to backend updates
window.update = function (dataString) {
  var data = JSON.parse(dataString);
  if (window.tgui) {
    window.tgui.set("config", data.config);
    if (typeof data.data !== 'undefined') {
      window.tgui.set("data", data.data);
      window.tgui.animate("adata", data.data);
    }
  }
};
</script>
<script defer src='tgui.js'></script>

<noscript>
  <div class="notice">
    <div>Javascript is required in order to use this interface.</div>
    <div>Please enable Javascript and restart the game.</div>
  </div>
</noscript>

</body>
</html>
